@use "./variables.scss" as *;

li:has(> input.checkbox-toggle),
li:has(> p > input.checkbox-toggle),
li:has(> label > input.checkbox-toggle) {
  list-style: none;
  position: relative;

  &::marker {
    content: none;
  }
}

input.checkbox-toggle {
  --checkbox-size: 0.85rem;

  // ol has extra padding-left
  --ul-left: calc(-1 * var(--checkbox-size) - 0.75 * #{$base-margin});
  --ol-left: calc(-1 * var(--checkbox-size) - 0.25 * #{$base-margin});

  appearance: none;
  position: absolute;
  top: 0.3em;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  margin: 0;
  cursor: pointer;
  transition:
    background-color 0.2s ease,
    border-color 0.2s ease;
  border-radius: 4px;
  border: 1.5px solid var(--midground-faint);
  background-color: transparent;

  // Most recent list ancestor is ul
  ul > li > &,
  ul > li > p > &,
  ul > li > label > & {
    left: var(--ul-left);
  }

  // Most recent list ancestor is ol
  ol > li > &,
  ol > li > p > &,
  ol > li > label > & {
    left: var(--ol-left);

    // Safari uses margin-left instead of padding-left on ol > li
    // Need to compensate by shifting checkbox left by that amount
    @supports (-webkit-hyphens: none) {
      left: calc(var(--ol-left) - #{$li-padding-left});
    }
  }

  &:focus-visible {
    outline: 1.5px solid var(--color-link);
    outline-offset: 1.5px;
  }

  // Checked boxes and their box children will be styled the same
  &:checked,
  li:has(> input.checkbox-toggle:checked) &,
  li:has(> * > input.checkbox-toggle:checked) &,
  li:has(> label > input.checkbox-toggle:checked) & {
    --checkbox-color: light-dark(
      color-mix(in srgb, var(--green), var(--light) 20%),
      color-mix(in srgb, var(--green), var(--dark) 45%)
    );

    background-color: var(--checkbox-color);
    border-color: var(--checkbox-color);

    &::after {
      content: "âœ“";
      color: var(--light);
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
  }
}

// Punctilio options use inline-flow checkboxes, not the
// absolute-positioned margin checkboxes used in task lists.
#punctilio-demo input.checkbox-toggle {
  position: relative;
  top: 1px; // nudge down to align with text visual center
  left: auto;
  flex-shrink: 0;
}

// Make lighter in a way that includes eg favicons

:is(
    li:has(> input.checkbox-toggle:checked),
    li:has(> * > input.checkbox-toggle:checked),
    li:has(> label > input.checkbox-toggle:checked)
  ):not(
    li:has(> input.checkbox-toggle:checked) *,
    li:has(> * > input.checkbox-toggle:checked) *,
    li:has(> label > input.checkbox-toggle:checked) *,
    #punctilio-demo *
  ) {
  opacity: 0.75;
}

// Checked state
:is(
    li:has(> input.checkbox-toggle:checked),
    li:has(> * > input.checkbox-toggle:checked),
    li:has(> label > input.checkbox-toggle:checked)
  ):not(#punctilio-demo *) {
  &,
  & p {
    text-decoration: line-through;
    text-decoration-color: var(--midground-faint);
  }
}
