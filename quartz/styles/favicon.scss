@use "./variables.scss" as *;

.subtitle {
  & .favicon {
    // Smaller favicon for smaller font
    --favicon-size: calc(var(--font-size-minus-1) * 0.65);

    width: var(--favicon-size);
    height: var(--favicon-size);
  }
}

.favicon-span {
  white-space: nowrap;
}

.favicon {
  display: inline;
  width: 0.65rem;
  height: 0.65rem;
  margin: -20% auto -0.07em calc(0.125 * $base-margin);
  vertical-align: 10%;
  cursor: text;

  // Don't pollute copied text with favicon
  user-select: none;

  // Make favicons align properly with headings
  h1 &,
  h2 &,
  h3 &,
  h4 &,
  h5 &,
  h6 & {
    vertical-align: 65%;
  }

  &.close-text {
    margin-left: 0.05rem;
  }
}

// SVG-specific styling using masks for color control
svg.favicon {
  --color-percentage: 40%;
  --svg-color: var(--foreground);

  display: inline-block;
  mask: var(--mask-url) no-repeat center / contain;
  filter: none; // Don't apply img filters to masks
  mix-blend-mode: normal;

  // Per-domain colors using color-mix
  background-color: color-mix(in srgb, var(--foreground), var(--svg-color) var(--color-percentage));

  :root[data-theme="dark"] & {
    --color-percentage: 30%;
  }

  // Rotate and flip anchor icon to resemble the trout within-site icon
  &[data-domain="anchor"] {
    transform: rotate(-90deg) scaleX(-1);
  }

  // &[data-domain="proton_me"] {
  //   --proton-dimension: 0.6rem;

  //   width: var(--proton-dimension);
  //   height: var(--proton-dimension);
  // }
}

.favicon-span > svg.favicon[data-domain="mail"] {
  margin-left: 0.05rem;
}

// Per-domain SVG colors
$domain-svg-colors: (
  "arbital_com": var(--green),
  "arxiv_org": var(--red),
  "cnn_com": var(--red),
  "deepmind_com": var(--blue),
  "discord_gg": color-mix(in srgb, var(--purple) 50%, var(--blue)),
  "forum_effectivealtruism_org": var(--teal),
  "google_com": var(--blue),
  "colab_research_google_com": var(--gold),
  "docs_google_com": var(--blue),
  "scholar_google_com": var(--blue),
  "huggingface_co": var(--yellow),
  "matsprogram_org": var(--red),
  "open_spotify_com": var(--green),
  "overleaf_com": var(--green),
  "proton_me": var(--purple),
  "reddit_com": var(--red),
  "rss": var(--orange),
  "substack_com": var(--orange),
  "youtube_com": var(--red),
);

@each $domain, $color in $domain-svg-colors {
  svg.favicon[data-domain="#{$domain}"] {
    --svg-color: #{$color};
  }
}

// Yellow arrow on bottom
svg.favicon[data-domain="amazon_com"] {
  --yellow-target: var(--yellow);

  :root[data-theme="dark"] & {
    --yellow-target: color-mix(in srgb, var(--yellow) var(--color-percentage), var(--foreground));
  }

  background: linear-gradient(to bottom, var(--foreground) 75%, var(--yellow-target) 70%);
}
